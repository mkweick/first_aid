<% show = params[:show] %>

<div class="col-xs-12 col-sm-12 col-md-12 text-center">
  <strong><%= @customer.cust_name %> (<%= @customer.cust_num %>)</strong>
  <br/>
  Building Name:
    <% if session[:building] %>
    <%= link_to session[:building],
                new_building_kit_location_path(cust_id: @customer.id) %>
    <% else %>
      <%= link_to "Set Building",
                  new_building_kit_location_path(cust_id: @customer.id) %>
    <% end %>
  <br/>
  Kit Location:
    <% if session[:kit] %>
    <%= link_to session[:kit],
                new_building_kit_location_path(cust_id: @customer.id) %>
    <% else %>
      <%= link_to "Set Kit Location",
                  new_building_kit_location_path(cust_id: @customer.id) %>
    <% end %>
  <hr/>
</div>
<div class="row">
  <div class="text-center">
    <%= form_tag customer_items_path, method: "get" do %>
      <div class="form-group col-xs-6 col-sm-5 col-sm-offset-2 col-md-4 col-md-offset-3">
        <%= text_field_tag :item, (params[:item].strip if params[:item]),
                                  placeholder: "Item# or Keyword",
                                  autofocus: :autofocus,
                                  type: :search,
                                  class: "form-control cust-search" %>
      </div>
      <%= hidden_field_tag :show, value = 1 %>
      <div class="col-xs-6 col-sm-3 col-md-3 text-left">
        <%= submit_tag "Pricing", name: "get_pricing",
                                  class: "btn btn-primary right-10" %>
        <%= submit_tag "Search",  name: "item_search",
                                  class: "btn btn-primary" %>
      </div>
    <% end %>
    <% if params[:item_display] %>
      <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-7 col-md-offset-3">
        <span class="itm-sm pull-left"><%= params[:item_desc] %></span>
        <br/>
        <span class="itm-sm pull-left">
          Price: $<%= params[:item_price] %> &nbsp;&nbsp;&nbsp;&nbsp;
          Type: <%= params[:item_price_type] == "HIST" ? "History" : "List Price" %>
        </span>
        <br/>
        <span class="itm-sm pull-left">Available Qty: <%= params[:item_qty] %></span>
        <br/>
        <%= form_tag customer_items_path(@customer.id),
                                        method: 'post',
                                        class: "form-horizontal" do %>
          <%= hidden_field_tag :building, session[:building] %>
          <%= hidden_field_tag :kit, session[:kit] %>
          <%= hidden_field_tag :item_num, params[:item].strip %>
          <%= hidden_field_tag :item_desc, params[:item_desc].strip %>
          <%= hidden_field_tag :item_price, params[:item_price] %>
          <%= hidden_field_tag :item_price_type, params[:item_price_type] %>
          <div class="form-group text-left">
            <%= label_tag :item_qty, "QTY:",
                          class: "col-xs-2 col-sm-1 col-md-1 control-label" %>
            <div class="col-xs-4 col-sm-3 col-md-3">
              <%= number_field_tag :item_qty, nil, class: "form-control" %>
            </div>
            <div class="col-xs-4 col-sm-2 col-md-2">
              <%= submit_tag "Record Sale", class: "btn btn-success" %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<hr/>
<div class= "row">
  <div class="col-md-9 col-md-offset-1">
    <% if @item_results.nil? %>
      <%= "<h4 class='text-center'>NO MATCHES FOUND</h4>".html_safe if show %>
    <% else %>
      <table width="100%" class="table">
        <tr class="th-row">
          <th width="13%">Item #</th>
          <th width="75%">Description</th>
          <th width="12%">Avail Qty</th>
        </tr>
        <% @item_results.each do |itm| %>
          <tr>
            <% if itm[2].to_f > 0 %>
              <td>
                <%= link_to itm[0], get_item_pricing_customer_path(
                                                      @customer.id,
                                                      item_num: itm[0],
                                                      item_desc: itm[1],
                                                      item_qty: itm[2]),
                                                      method: 'post' %>
              </td>
            <% else %>
              <td><%= itm[0] %></td>
            <% end %>
            <td><%= itm[1] %></td>
            <td><%= itm[2] %></td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>
</div>
